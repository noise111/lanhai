{template 'web/common/header-base'}
<div class="wrapper wrapper-content animated ">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="{php echo $this->createWebUrl('supermark',array('op' => 'dp'))}" title="超市管理" >超市管理</a></li>
                    <li><a href="{php echo $this->createWebUrl('supermark',array('op' => 'qrlist'))}" title="二维码管理" >二维码管理</a></li>
                </ul>
                <div class="ibox-content">
                    <form action="./index.php" method="get" class="form-horizontal" role="form">
                        <input type="hidden" name="c" value="site"/>
                        <input type="hidden" name="a" value="entry"/>
                        <input type="hidden" name="m" value="{php echo $this->module['name']}"/>
                        <input type="hidden" name="do" value="business"/>
                        <input type="hidden" name="op" value="dp"/>
                        <div class="row">
                            <div class="col-sm-12 m-b-xs">
                                {if ($user && $menu_opss && @in_array('supermark_dpAdd', $menu_opss)) || empty($user)}
                                <a class="btn btn-primary" href="{php echo $this->createWebUrl('supermark', array('op' => 'dp','p' => 'add'))}"><i class="fa fa-plus"></i> 添加超市</a>
                                {/if}
                            </div>
                        </div>
                    </form>

                    <table class="table table-bordered" ng-controller="advAPI" style="width:100%;" cellspacing="0" cellpadding="0">
                        <thead>
                        <tr>
                            <th width="100">超市编号</th>
                            <th width="100">超市名称</th>
                            <th width="100">地址</th>
                            <th width="80">电话</th>
                            <th width="60">设备编号</th>
                            <th width="110">开门范围</th>
                            <th width="300" >操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        {loop $list $item}
                        <tr>
                            <td>{$item['id']}</td>
                            <td>{$item['title']}</td>
                            <td>{$item['address']}</td>
                            <td>{$item['tel']}</td>
                            <td>{$item['device_code']}</td>
                            <td>{$item['range']}km</td>
                            <td >
                                {if ($user && $menu_opss && @in_array('supermark_dpEdit', $menu_opss)) || empty($user)}
                                <a href="{php echo $this->createWebUrl('supermark',array('op' => 'dp','p' => 'add','id' => $item['id']))}" class="btn btn-primary btn-sm" title="编辑">编辑</a>
                                {/if}
                                {if ($user && $menu_opss && @in_array('supermark_dpDel', $menu_opss)) || empty($user)}
                                <a class="btn btn-default" onclick="del({$item['id']})" title="删除">删除</a>
                                {/if}
                                {if ($user && $menu_opss && @in_array('supermark_dpQr', $menu_opss)) || empty($user)}
                                <a href="{php echo $this->createWebUrl('supermark',array('op' => 'dp','p' => 'create','id' => $item['id']))}" class="btn btn-warning btn-sm" title="生成二维码">生成二维码</a>
                                {/if}
                            </td>
                        </tr>
                        {/loop}
                        </tbody>
                    </table>
                    <table class="footable table table-stripped toggle-arrow-tiny footable-loaded tablet breakpoint">
                        <thead>
                        {if $list}
                        <tr>
                            <td class="footable-visible"><ul class="pagination pull-right">{$pager}</ul></td>
                        </tr>
                        {else}
                        <tr style="text-align: center"><td >没有找到对应的记录</td></tr>
                        {/if}
                        </thead>
                    </table>
                </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    function del(id) {
        var id = id;
        var url = "{php echo $this->createWebUrl('supermark',array('op' => 'dp','p'=>'del'))}";
        $.post(url, {
                id: id
            },
            function(msg) {
                if (msg.status == 1) {
                    setTimeout(function() {
                        window.location.reload();
                    }, 100);
                };

            },
            'json');
    }
</script>

